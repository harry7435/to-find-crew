# 팀 뽑기 로직 간소화

> **상태: 구현 완료** (2026-02-19)

## 목표 (완료)

1. Team A/B 개념 제거 - 단순히 4명만 뽑기
2. 직접 뽑기도 팀 구분 없이 4명 선택
3. 통계를 개인별 게임 횟수 + 4명 간 공동 게임 횟수로 표시
4. 뽑힌 4명 카드와 공동 게임 이력을 SVG 그래프로 통합

---

## 구현된 변경 사항

### 1. 데이터 모델 (useGameManager.ts)

**GameRecord 인터페이스:**
```typescript
export interface GameRecord {
  id: string;
  players: [string, string, string, string]; // teamA/teamB → players 배열
  confirmedAt: string;
}
```

**마이그레이션 (localStorage 하위 호환):**
```typescript
interface LegacyGameRecord {
  id: string;
  teamA: [string, string];
  teamB: [string, string];
  confirmedAt: string;
}
type RawGameRecord = GameRecord | LegacyGameRecord;

function isLegacyGameRecord(game: RawGameRecord): game is LegacyGameRecord {
  return 'teamA' in game && 'teamB' in game && !('players' in game);
}
// 로드 시 자동 변환, any 타입 없음
```

### 2. 랜덤 뽑기 (smartTeamPicker.ts)

```typescript
// Before: { teamA: [Player, Player]; teamB: [Player, Player] }
// After:
export function randomTeamPicker(players: Player[]): [Player, Player, Player, Player]
```

### 3. 메인 페이지 (page.tsx)

```typescript
// Before
const [pickedTeams, setPickedTeams] = useState<{ teamA, teamB } | null>(null);
// After
const [pickedPlayers, setPickedPlayers] = useState<[Player, Player, Player, Player] | null>(null);
```

### 4. TeamPicker 컴포넌트 (TeamPicker.tsx)

기존 텍스트 목록 → **고정 크기 SVG 그래프**로 변경

**레이아웃 상수 (컴파일 타임 계산, 런타임 측정 불필요):**
```typescript
const CARD_W = 112; const CARD_H = 84;
const H_GAP  = 60;  const V_GAP  = 48;
const SVG_W = 284;  const SVG_H = 216;
```

**6개 연결선 구성:**
- 상단 가로 (P0-P1), 하단 가로 (P2-P3): 실선 1.5px
- 좌측 세로 (P0-P2), 우측 세로 (P1-P3): 실선 1.5px
- 대각선 P0↔P3, 대각선 P1↔P2: 실선 1px

**공동 게임 횟수 색상 (EdgeLabel):**
```typescript
function getCoPlayColors(count: number): { fill: string; stroke: string } {
  if (count === 0) return { fill: '#16a34a', stroke: '#bbf7d0' }; // green  – 첫조합
  if (count <= 2)  return { fill: '#6b7280', stroke: '#e5e7eb' }; // gray   – 1~2회
  if (count <= 4)  return { fill: '#d97706', stroke: '#fde68a' }; // amber  – 3~4회
  return                  { fill: '#dc2626', stroke: '#fecaca' }; // red    – 5회+
}
```

**대각선 레이블 위치 (카드에 가려지지 않도록):**
- DIAG_A (P0↔P3): P0 카드 우하단 바로 아래 `(104, 96)`
- DIAG_B (P1↔P2): P1 카드 좌하단 바로 아래 `(180, 96)`

**실제 UI 구조:**
```
         (c01 회)
  [P0] ──────────── [P1]
   │ \(c03)  (c12)/ │
(c02)  ✕          ✕  (c13)
   │ /            \ │
  [P2] ──────────── [P3]
         (c23 회)
```
- 레이블: `0회=첫조합(초록)`, `1~2회(회색)`, `3~4회(주황)`, `5회+(빨강)`
- top 라벨은 선 위로 겹치지 않게 y 오프셋 적용 (`CY0 - 14`)

### 5. CustomTeamPicker (CustomTeamPicker.tsx)

- Team A/B 섹션 제거
- `selectedPlayers: Player[]` 단일 상태 (최대 4명)
- 클릭으로 선택/해제, 4명 완료 시 확정 버튼 활성화

### 6. GameHistory (GameHistory.tsx)

- 게임 기록: Team A vs B → 4명 2×2 그리드 표시
- 통계 탭: 페어 통계 제거, 개인별 progress bar 추가
  - 초록 (하위 33%): 게임 적음
  - 노랑 (34~66%): 평균
  - 주황 (67%+): 게임 많음

---

## 주요 파일

- [src/hooks/useGameManager.ts](src/hooks/useGameManager.ts)
- [src/app/game-manager/page.tsx](src/app/game-manager/page.tsx)
- [src/components/game-manager/TeamPicker.tsx](src/components/game-manager/TeamPicker.tsx)
- [src/components/game-manager/CustomTeamPicker.tsx](src/components/game-manager/CustomTeamPicker.tsx)
- [src/components/game-manager/GameHistory.tsx](src/components/game-manager/GameHistory.tsx)
- [src/utils/smartTeamPicker.ts](src/utils/smartTeamPicker.ts)
